extract_body:
  assign:
    content: ${incoming.body.content}
    chatId: ${incoming.body.chatId}
    authorId: ${incoming.body.authorId}

common_service2:
  call: http.post
  args:
    url: "[#CHATBOT_RUUTER_PUBLIC_INTERNAL_CS]/services/companies/employees"
    body:
      message: ${content.match(/^#employees (.*)/)[1]}
  result: post_message_to_bot_result
  next: extract_bot_responses_opensearch

extract_bot_responses_opensearch:
  assign:
    botMsg: ${[post_message_to_bot_result.response.body.response]}
  next: convert_bot_responses_to_messages  

convert_bot_responses_to_messages:
  call: http.post
  args:
    url: "[#CHATBOT_DMAPPER]/hbs/chat-bot/bot_responses_to_messages"
    headers:
      type: json
    body:
      data:
        {
          "botMessages": "${botMsg}",
          "chatId": "${chatId}",
          "authorId": "${get_bot_name_result.response.body[0].value}",
          "authorFirstName": "",
          "authorLastName": "",
          "authorTimestamp": "${new Date().toISOString()}",
          "created": "${new Date().toISOString()}",
        }
  result: converted_messages_res
  next: add_bot_message_to_db  
