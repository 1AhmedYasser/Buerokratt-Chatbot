assignIncoming:
  assign:
    chatId: ${incoming.params.chatId}
    interval: ${incoming.body.interval}

getAverageWaitingTimeInSeconds:
  call: http.post
  args:
    url: https://byk-resql:8443/get-average-waiting-time-in-seconds-by-interval
    body:
      interval: ${interval}
  result: averageWaitingTimeInSeconds

getOpenAgentChatAmount:
  call: http.post
  args:
    url: https://byk-resql:8443/get-open-agent-chat-amount
  result: openAgentChatAmount

getPositionInActiveChats:
  call: http.post
  args:
    url: https://byk-resql:8443/get-position-in-active-chats-by-chat-id
    body:
      chatId: ${incoming.body.chatId}
  result: positionInActiveChats

assignResponseVariables:
  assign:
    chatSeconds: ${averageWaitingTimeInSeconds.response.body[0].chatSeconds}
    openChats: ${openAgentChatAmount.response.body[0].openChats}
    position: ${positionInActiveChats.response.body[0].position}

checkChatIdParameter:
  switch:
    - condition: ${!!chatId && chatId !== "" && chatId !== null}
      next: returnWithChatIdParameter
  next: returnWithoutChatIdParameter

returnWithChatIdParameter:
  return: ${position}
  next: end

returnWithoutChatIdParameter:
  return: ${chatSeconds / openChats}
  next: end
